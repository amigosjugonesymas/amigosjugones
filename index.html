<!DOCTYPE html>
<html lang="es">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <title>Amigos Jugones</title>
  <style>
    :root { 
      --primary: #112F4F; 
      --accent: #ff4757; 
      --purple: #6c5ce7; 
      --bg: #f8f9fc; 
      --white: #ffffff; 
      --text: #2d3436;
    }

    body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }

    /* Barra de Navegaci√≥n */
    .navbar { 
      background: var(--primary); color: white; padding: 12px 20px; position: sticky; 
      top: 0; z-index: 1000; display: flex; align-items: center; gap: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .menu-icon { font-size: 28px; cursor: pointer; }
    .nav-title { font-weight: 700; font-size: 1.1rem; }

    /* Men√∫ Lateral */
    .sidebar { 
      position: fixed; left: -280px; top: 0; height: 100%; width: 280px; 
      background: white; z-index: 1001; transition: 0.3s; 
      box-shadow: 5px 0 15px rgba(0,0,0,0.1); overflow-y: auto; 
    }
    .sidebar.open { left: 0; }
    
    .sidebar-header {
      padding: 20px; background: var(--primary); color: white;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      border-bottom: 2px solid var(--accent);
    }
    .sidebar-title { font-weight: 700; font-size: 1rem; text-align: center; }

    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; }
    .overlay.show { display: block; }
    
    .menu-item { padding: 15px 25px; cursor: pointer; font-weight: 600; border-bottom: 1px solid #f0f0f0; transition: 0.2s; color: var(--primary); }
    .menu-item:hover { background: #f8f9fc; color: var(--accent); padding-left: 30px; }

    /* Contenedor Principal */
    .main-content { max-width: 950px; margin: 20px auto; padding: 0 15px; }
    #content-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); min-height: 400px; }

    .seccion-intro { padding: 18px; background: #fff5f5; border-left: 5px solid var(--accent); margin-bottom: 25px; border-radius: 12px; font-style: italic; font-size: 14px; }

    /* Estilos Nosotros (Mejorado) */
    .nosotros-item { margin-bottom: 15px; line-height: 1.6; }
    .nosotros-titulo { font-size: 1.4rem; font-weight: 700; margin: 25px 0 15px; color: var(--primary); border-bottom: 2px solid #eee; padding-bottom: 5px; }
    .nosotros-row { background: #fcfcfc; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #ddd; }

    /* Estilos Geekstories */
    .geekstory-card { background: #fdfdff; border: 2px dashed #d1d8e0; border-radius: 15px; padding: 20px; margin-bottom: 20px; position: relative; transition: 0.3s; }
    .geekstory-card:hover { border-color: var(--purple); background: #f8f8ff; }
    .geekstory-narrativa { font-size: 1.1rem; line-height: 1.6; color: var(--primary); font-style: italic; margin-bottom: 15px; }
    .geekstory-reveal-btn { background: var(--purple); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; }
    .geekstory-solucion { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-weight: 700; color: #20bf6b; font-size: 1.2rem; text-align: center; }

    /* Tablas y Botones */
    .table-scroll { width: 100%; overflow-x: auto; border: 1px solid #eee; border-radius: 12px; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th, td { padding: 14px 16px; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
    .button-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; }
    .custom-button { padding: 18px; border: 1px solid #e0e0e0; border-radius: 12px; text-decoration: none; color: var(--primary); text-align: center; font-weight: 700; background: white; transition: 0.3s; }
    .custom-button:hover { background: var(--primary); color: white; transform: translateY(-3px); }

    .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 60px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
    <div class="nav-title" id="current-title">Amigos Jugones</div>
  </div>

  <div class="overlay" id="overlay" onclick="toggleMenu()"></div>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">Men√∫ Principal</div>
    </div>
    <div id="menu-items"></div>
    <div id="loading-indicator" style="padding:15px; font-size:12px; color:#999;">Cargando base de datos...</div>
  </div>

  <div class="main-content">
    <div id="content-card">
      <div id="links-list"><div class="loader"></div></div>
    </div>
  </div>

  <script>
    let cacheData = {};
    let fullOrder = ["Nosotros"];

    function toggleMenu() { 
      document.getElementById('sidebar').classList.toggle('open'); 
      document.getElementById('overlay').classList.toggle('show'); 
    }

    window.onload = () => {
      fetch('datos.json')
        .then(response => {
          if (!response.ok) throw new Error("A√∫n no se ha sincronizado el archivo datos.json");
          return response.json();
        })
        .then(res => {
          cacheData[res.initial.nombre] = res.initial.contenido;
          cacheData = {...cacheData, ...res.remaining.contenido};
          fullOrder = ["Nosotros", ...res.remaining.orden];
          renderMenu(fullOrder);
          displayData("Nosotros");
          document.getElementById('loading-indicator').style.display = 'none';
        })
        .catch(err => {
          document.getElementById('links-list').innerHTML = `<p style="text-align:center; color:red;">${err.message}<br>Pulsa el bot√≥n de actualizaci√≥n en tu Google Sheets.</p>`;
        });
    };

    function renderMenu(names) {
      const menuDiv = document.getElementById('menu-items');
      menuDiv.innerHTML = '';
      names.forEach(name => {
        const item = document.createElement('div');
        item.className = 'menu-item';
        item.innerText = name;
        item.onclick = () => { displayData(name); toggleMenu(); };
        menuDiv.appendChild(item);
      });
    }

    function displayData(name) {
      document.getElementById('current-title').innerText = name;
      const data = cacheData[name];
      const list = document.getElementById('links-list');
      if(!data) return;

      let html = data.introduccion ? `<div class="seccion-intro">${data.introduccion}</div>` : "";

      if (name.toLowerCase().includes("geekstories")) {
        html += renderGeekstories(data);
      } else if (data.tipo === 'subpesta√±as') {
        html += renderTabsContainer(name, data);
      } else {
        html += renderOthers(data);
      }
      list.innerHTML = html;
      
      if (data.tipo === 'subpesta√±as') {
        const firstTab = Object.keys(data.datos)[0];
        if(firstTab) renderTable(null, name, firstTab);
      }
    }

    function renderGeekstories(data) {
      if(!data.items || data.items.length === 0) return "<p>No hay historias disponibles.</p>";
      return data.items.map((item) => `
        <div class="geekstory-card">
          <div class="geekstory-narrativa">"${item.titulo}"</div>
          <button class="geekstory-reveal-btn" onclick="this.nextElementSibling.style.display='block'; this.style.display='none'">Revelar Soluci√≥n</button>
          <div class="geekstory-solucion">üéØ ${item.contenido}</div>
        </div>
      `).join('');
    }

    function renderTabsContainer(name, data) {
      let tabs = Object.keys(data.datos);
      let html = `<div class="sub-nav" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; margin-bottom:20px;">`;
      tabs.forEach((t, i) => {
        html += `<div class="sub-tab ${i===0?'active':''}" style="padding:8px 15px; background:#eee; border-radius:20px; cursor:pointer;" onclick="renderTable(this, '${name}', '${t}')">${t}</div>`;
      });
      html += `</div><div id="table-place"></div>`;
      return html;
    }

    function renderOthers(data) {
      if(data.tipo === 'calendar') return `<iframe src="https://calendar.google.com/calendar/embed?src=amigosjugones%40gmail.com&ctz=America%2FSantiago" style="border:0; width:100%; height:600px; border-radius:12px;"></iframe>`;
      if(data.tipo === 'botones') return `<div class="button-grid">` + data.items.map(b => `<a href="${b.url}" target="_blank" class="custom-button">${b.nombre}</a>`).join('') + `</div>`;
      
      if(data.tipo === 'nosotros_block') {
        return data.items.map(it => {
          if (it.esTitulo) {
            return `<div class="nosotros-titulo">${it.titulo}</div>`;
          } else {
            return `<div class="nosotros-row"><b>${it.titulo}</b>: ${it.contenido}</div>`;
          }
        }).join('');
      }
      return "";
    }

    window.renderTable = (btn, parentName, subName) => {
      if(btn) {
        document.querySelectorAll('.sub-tab').forEach(t => { t.style.background='#eee'; t.style.color='black'; });
        btn.style.background = 'var(--purple)'; btn.style.color = 'white';
      }
      const rows = cacheData[parentName].datos[subName];
      let html = `<div class="table-scroll"><table>`;
      rows.forEach((row, i) => {
        html += `<tr>`;
        row.forEach(cell => {
          let tag = (i <= 1) ? 'th' : 'td';
          let style = `background:${cell.color}; color:${(i<=1)?'white':'black'}`;
          html += `<${tag} style="${style}">${cell.texto}</${tag}>`;
        });
        html += `</tr>`;
      });
      document.getElementById('table-place').innerHTML = html + `</table></div>`;
    }
  </script>
</body>
</html>
