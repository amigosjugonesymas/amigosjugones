<!DOCTYPE html>
<html lang="es">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B1XDJ24N19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B1XDJ24N19');
  </script>

  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://lh3.googleusercontent.com/d/1ccDHMIuofULLOph-AokaJPSONweRamvm">
  <title>Amigos Jugones</title>
  
  <style>
    :root { 
      --primary: #112F4F; --accent: #ff4757; --purple: #6c5ce7; 
      --bg: #f8f9fc; --white: #ffffff; --text: #2d3436;
      --instagram: #E1306C; --whatsapp: #25D366;
    }
    body { font-family: 'Montserrat', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }
    @keyframes pulse-glow {
      0% { color: white; transform: scale(1); }
      50% { color: var(--accent); transform: scale(1.2); text-shadow: 0 0 10px var(--accent); }
      100% { color: white; transform: scale(1); }
    }
    .navbar { background: var(--primary); color: white; padding: 0 15px; position: sticky; top: 0; z-index: 1000; display: flex; align-items: center; height: 60px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); gap: 15px; }
    .menu-icon { font-size: 28px; cursor: pointer; display: flex; align-items: center; animation: pulse-glow 2.5s infinite; }
    .nav-brand { display: flex; align-items: center; gap: 10px; }
    .nav-logo { width: 38px; height: 38px; border-radius: 50%; background: white; border: 2px solid var(--white); object-fit: cover; }
    .nav-main-title { font-weight: 700; font-size: 1rem; letter-spacing: -0.5px; white-space: nowrap; }
    .current-section-indicator { margin-left: auto; font-size: 0.75rem; font-weight: 700; color: var(--accent); background: rgba(255,255,255,0.1); padding: 5px 12px; border-radius: 15px; text-transform: uppercase; }
    .sidebar { position: fixed; left: -280px; top: 0; height: 100%; width: 280px; background: white; z-index: 1001; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.1); overflow-y: auto; }
    .sidebar.open { left: 0; }
    .sidebar-header { padding: 30px 20px; background: var(--primary); color: white; display: flex; flex-direction: column; align-items: center; gap: 10px; border-bottom: 4px solid var(--accent); }
    .sidebar-logo-large { width: 70px; height: 70px; border-radius: 50%; background: white; padding: 3px; }
    .sidebar-title { font-weight: 700; font-size: 1.1rem; }
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1000; }
    .overlay.show { display: block; }
    .menu-item { padding: 16px 25px; cursor: pointer; font-weight: 600; border-bottom: 1px solid #f0f0f0; transition: 0.2s; color: var(--primary); }
    .menu-item:hover { background: #f8f9fc; color: var(--accent); padding-left: 32px; }
    .main-content { max-width: 950px; margin: 20px auto; padding: 0 15px; }
    #content-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); min-height: 400px; }
    .seccion-intro { padding: 18px; background: #fff5f5; border-left: 5px solid var(--accent); margin-bottom: 25px; border-radius: 12px; font-style: italic; font-size: 14px; line-height: 1.5; }
    .nosotros-contenedor { display: flex; flex-direction: column; gap: 5px; }
    .nosotros-titulo-principal { font-size: 1.5rem; font-weight: 800; margin: 30px 0 10px 0; color: var(--primary); display: inline-block; align-self: flex-start; }
    .nosotros-bloque-texto-agrupado { font-size: 17px; font-weight: 700; line-height: 1.6; color: var(--text); margin-bottom: 20px; padding-left: 15px; border-left: 5px solid var(--accent); }
    .nosotros-bloque-texto-agrupado p { margin: 0 0 12px 0; }
    .sub-nav { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }
    .sub-tab { padding: 10px 18px; background: #f0f0f0; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600; transition: 0.3s; }
    .sub-tab.active { background: var(--purple); color: white; }
    .table-scroll { width: 100%; overflow-x: auto; border: 1px solid #eee; border-radius: 12px; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th, td { padding: 14px 16px; border-bottom: 1px solid #f0f0f0; font-size: 14px; text-align: left; }
    .table-main-title { font-size: 1.2rem; text-align: center !important; padding: 20px; font-weight: 700; }
    .section-footer { margin-top: 50px; padding-top: 30px; border-top: 2px solid #f0f0f0; text-align: center; }
    .footer-label { font-size: 11px; font-weight: 800; color: #b2bec3; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 2px; }
    .footer-btns { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; max-width: 800px; margin: 0 auto; }
    .footer-btn { padding: 8px 15px; background: #f1f2f6; border-radius: 20px; text-decoration: none; color: var(--primary); font-size: 12px; font-weight: 600; transition: 0.2s; }
    .footer-btn:hover { background: var(--purple); color: white; }
    .contact-bar { margin-top: 30px; display: flex; justify-content: center; gap: 20px; padding: 15px; flex-wrap: wrap; }
    .social-link { display: flex; align-items: center; gap: 8px; text-decoration: none; font-weight: 700; font-size: 14px; padding: 10px 25px; border-radius: 30px; transition: 0.3s; }
    .link-ig { background: #fff0f5; color: var(--instagram); border: 2px solid var(--instagram); }
    .link-ig:hover { background: var(--instagram); color: white; }
    .link-ws { background: #e8f9ee; color: var(--whatsapp); border: 2px solid var(--whatsapp); }
    .link-ws:hover { background: var(--whatsapp); color: white; }
    .button-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; }
    .custom-button { padding: 18px; border: 1px solid #e0e0e0; border-radius: 12px; text-decoration: none; color: var(--primary); text-align: center; font-weight: 700; background: white; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
    .custom-button:hover { background: var(--primary); color: white; transform: translateY(-3px); }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 60px auto; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <div class="navbar">
    <div class="menu-icon" id="hamburguesa" onclick="toggleMenu()">â˜°</div>
    <div class="nav-brand">
      <img src="https://lh3.googleusercontent.com/d/1nOyeVJ0UnmVUKHTNkSA9DnkrUgY-IwQ2" class="nav-logo" alt="Logo">
      <div class="nav-main-title">Amigos Jugones</div>
    </div>
    <div id="current-title-display" class="current-section-indicator">Nosotros</div>
  </div>

  <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <img src="https://lh3.googleusercontent.com/d/1nOyeVJ0UnmVUKHTNkSA9DnkrUgY-IwQ2" class="sidebar-logo-large" alt="Logo">
      <div class="sidebar-title">Amigos Jugones</div>
    </div>
    <div id="menu-items"></div>
  </div>

  <div class="main-content">
    <div id="content-card">
      <div id="links-list"><div class="loader"></div></div>
    </div>
  </div>

  <script>
    let cacheData = {};
    let fullOrder = ["Nosotros"];
    const todasLasSecciones = ["Nosotros", "Calendario", "Actividades", "Participantes", "Divulgadores", "Creadores", "Organizaciones", "Tiendas", "Documentos", "Inscripciones"];

    // --- ANALYTICS TRACKING FUNCTIONS ---
    
    // Rastrea quÃ© secciÃ³n de la web estÃ¡n viendo
    function trackPageView(pageName) {
      if (typeof gtag === 'function') {
        gtag('event', 'page_view', {
          page_title: pageName,
          page_location: window.location.href + '#' + pageName.toLowerCase()
        });
      }
    }

    // Rastrea clics en Instagram o WhatsApp
    function trackSocialClick(network) {
      if (typeof gtag === 'function') {
        gtag('event', 'social_click', {
          'event_category': 'Engagement',
          'event_label': network
        });
      }
    }

    // Rastrea clics en los botones personalizados (Inscripciones, Tiendas, etc)
    function trackButtonClick(btnName) {
      if (typeof gtag === 'function') {
        gtag('event', 'custom_button_click', {
          'event_category': 'Outbound Links',
          'event_label': btnName
        });
      }
    }

    // --- LÃ“GICA DE LA APLICACIÃ“N ---

    function getContrastYIQ(hexcolor){
      if (!hexcolor || hexcolor === "#ffffff" || hexcolor === "transparent") return "black";
      hexcolor = hexcolor.replace("#", "");
      if(hexcolor.length === 3) hexcolor = hexcolor.split('').map(s => s+s).join('');
      var r = parseInt(hexcolor.substr(0,2),16);
      var g = parseInt(hexcolor.substr(2,2),16);
      var b = parseInt(hexcolor.substr(4,2),16);
      var yiq = ((r*299)+(g*587)+(b*114))/1000;
      return (yiq >= 128) ? 'black' : 'white';
    }

    function toggleMenu() { 
      document.getElementById('sidebar').classList.toggle('open'); 
      document.getElementById('overlay').classList.toggle('show'); 
      document.getElementById('hamburguesa').style.animation = "none";
    }

    window.onload = () => {
      fetch('datos.json?v=' + new Date().getTime())
        .then(response => response.json())
        .then(res => {
          cacheData[res.initial.nombre] = res.initial.contenido;
          cacheData = {...cacheData, ...res.remaining.contenido};
          fullOrder = ["Nosotros", ...res.remaining.orden];
          renderMenu(fullOrder);
          displayData("Nosotros");
        });
    };

    function renderMenu(names) {
      const menuDiv = document.getElementById('menu-items');
      menuDiv.innerHTML = '';
      names.forEach(name => {
        const item = document.createElement('div');
        item.className = 'menu-item';
        item.innerText = name;
        item.onclick = () => { displayData(name); toggleMenu(); };
        menuDiv.appendChild(item);
      });
    }

    function displayData(name) {
      window.scrollTo(0, 0);
      document.getElementById('current-title-display').innerText = name;
      
      trackPageView(name); // Track de secciÃ³n

      const data = cacheData[name];
      const list = document.getElementById('links-list');
      if(!data) return;

      let html = data.introduccion ? `<div class="seccion-intro">${data.introduccion}</div>` : "";

      if (data.tipo === 'subpestaÃ±as') {
        let tabs = Object.keys(data.datos);
        html += `<div class="sub-nav">`;
        tabs.forEach((t, i) => {
          html += `<div class="sub-tab ${i===0?'active':''}" onclick="renderTable(this, '${name}', '${t}')">${t}</div>`;
        });
        html += `</div><div id="table-place"></div>`;
        list.innerHTML = html;
        if(tabs.length > 0) renderTable(null, name, tabs[0]);
      } else {
        list.innerHTML = html + renderOthers(data);
      }

      // FOOTER CON TRACKING DE REDES SOCIALES
      let footerHtml = `
        <div class="section-footer">
          <div class="footer-label">NavegaciÃ³n RÃ¡pida</div>
          <div class="footer-btns">
            ${todasLasSecciones.filter(s => s !== name).map(s => `
              <a href="#" class="footer-btn" onclick="displayData('${s}'); return false;">${s}</a>
            `).join('')}
          </div>
          
          <div class="contact-bar">
            <a href="https://www.instagram.com/amigosjugonesymas/" target="_blank" class="social-link link-ig" onclick="trackSocialClick('Instagram')">
              ðŸ“¸ Instagram
            </a>
            <a href="https://chat.whatsapp.com/KaZmswdC0Kw5JnTADqojcK" target="_blank" class="social-link link-ws" onclick="trackSocialClick('WhatsApp')">
              ðŸ’¬ WhatsApp
            </a>
          </div>
        </div>
      `;
      list.innerHTML += footerHtml;
    }

    window.renderTable = (btn, parentName, subName) => {
      if(btn) { 
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active')); 
        btn.classList.add('active'); 
      }
      const rows = cacheData[parentName].datos[subName];
      if(!rows || rows.length === 0) return;

      let html = `<div class="table-scroll"><table>`;
      rows.forEach((row, i) => {
        if (i === 0) {
          let bgColor = row[0].color || 'var(--primary)';
          let textColor = getContrastYIQ(bgColor);
          html += `<tr><th colspan="${row.length}" class="table-main-title" style="background-color: ${bgColor}; color: ${textColor};">${row[0].texto}</th></tr>`;
        } else {
          html += `<tr>`;
          row.forEach(cellObj => {
            let tag = (i === 1) ? 'th' : 'td';
            let bgColor = cellObj.color || '#ffffff';
            let textColor = (i === 1) ? getContrastYIQ(bgColor) : 'black';
            html += `<${tag} style="background-color: ${bgColor}; color: ${textColor};">${cellObj.texto || ''}</${tag}>`;
          });
          html += `</tr>`;
        }
      });
      document.getElementById('table-place').innerHTML = html + `</table></div>`;
    }

    function renderOthers(data) {
      if(data.tipo === 'calendar') {
        return `<iframe src="https://calendar.google.com/calendar/embed?src=amigosjugonesymas%40gmail.com&ctz=America%2FSantiago" style="border:0; width:100%; height:600px; border-radius:12px;"></iframe>`;
      }
      if(data.tipo === 'botones') {
        return `<div class="button-grid">` + 
          data.items.map(b => `<a href="${b.url}" target="_blank" class="custom-button" onclick="trackButtonClick('${b.nombre}')">${b.nombre}</a>`).join('') + 
        `</div>`;
      }
      
      if(data.tipo === 'nosotros_block') {
        let nHtml = '<div class="nosotros-contenedor">';
        let bloqueAgrupado = ""; 
        data.items.forEach((it) => {
           if(it.esTitulo) {
             if(bloqueAgrupado !== "") {
               nHtml += `<div class="nosotros-bloque-texto-agrupado">${bloqueAgrupado}</div>`;
               bloqueAgrupado = "";
             }
             nHtml += `<div class="nosotros-titulo-principal">${it.titulo}</div>`;
           } else {
             let textoLimpio = it.contenido.replace(/\n/g, '<br>');
             let prefijo = it.titulo ? `<span>${it.titulo}:</span> ` : "";
             bloqueAgrupado += `<p>${prefijo}${textoLimpio}</p>`;
           }
        });
        if(bloqueAgrupado !== "") nHtml += `<div class="nosotros-bloque-texto-agrupado">${bloqueAgrupado}</div>`;
        return nHtml + '</div>';
      }
      return "";
    }
  </script>
</body>
</html>
